<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quizzatopia Community</title>
    <meta name="robots" content="nofollow">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"  crossorigin="anonymous">


  <script  defer src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.3/umd/popper.min.js"></script>

  <script  defer src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

	  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css">
	  <script  defer src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.2/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <link rel="stylesheet" href="./style.css" />
  
    <link rel="import" href="./elements/navbar.html">
    <link rel="import" href="./elements/footer.html">
	  
	   <div id="navbar"></div>
  <!-- Firebase SDK -->
  <script  src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script  src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script  src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

  <!-- Custom scripts -->
  <script  src="/main.js"></script> 
  	<style>
	

		.shadow {
			box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
		}
	</style>
 </head>
<body>
  <!-- Header -->

  <button class="start-discussion-button" onclick="openCreateThreadPopup()">Start Discussion</button>


  <!-- Main Content -->
  <main>
	  
    <!-- Channel Sidebar -->
    <aside class="channel-sidebar">
      <h2>Channels</h2>
      <!-- Display a list of channels -->
      <ul>
        <li><a href="#">General Knowledge</a></li>
        <li><a href="#">Pop Culture</a></li>
        <li><a href="#">Science</a></li>
        <!-- Add more channels here -->
      </ul>
    </aside>
	  
	  
	  
  <div class="container">
	  
<!-- Toolbar -->
  <div class="toolbar">
    <button class="button" onclick="switchView('thread-listing-view')">Thread Listing</button>
    <button class="button" onclick="switchView('thread-details-view')">Thread Details</button>
  </div>

  <!-- View Container -->
  <div class="view-container">
    <!-- Thread Listing View -->
    <section id="thread-listing-view" class="view active">
      <h2>Main Discussion</h2>
      <ul id="thread-list"></ul>
    </section>

    <!-- Thread Details View -->
    <section id="thread-details-view" class="view">
      <button id="back-to-listing-button" class="button" onclick="switchView('thread-listing-view')">Back to Listing</button>
      <!-- Display thread details like author, date, content, replies, etc. -->
      <div id="thread-content">
        <p>Thread content goes here</p>
      </div>
      <div class="replies">
        <!-- Display thread replies -->
        <div class="reply">
          <!-- Display individual reply content -->
        </div>
        <!-- Add more replies here -->
      </div>
    </section>
  </div>

	  
	  
	  
	  
	  
	  
	  <section id="reply-popup" class="create-thread-popup">
  <div class="create-thread-container">
    <button class="exit-button" onclick="closeReplyPopup()">X</button>
    <h2>Reply to Thread</h2>
    <form id="reply-form">
      <label for="reply-content">Reply Content:</label>
      <textarea id="reply-content" required></textarea>

      <button type="submit">Submit Reply</button>
    </form>
  </div>
</section>
	  
	  
	  
	  
	  
	  
	  
	  <!-- Create Thread Form -->
<section class="create-thread-popup">
  <div class="create-thread-container">
    <button class="exit-button" onclick="closeCreateThreadPopup()">X</button>
    <h2>Create a New Thread</h2>
    <form id="create-thread-form">
      <label for="thread-title">Thread Title:</label>
      <input type="text" id="thread-title" required>

      <label for="thread-content">Thread Content:</label>
      <textarea id="thread-content" required></textarea>

      <button type="submit">Create Thread</button>
    </form>
  </div>
</section>

	  
	  
	  
  </div>


  </main>


  <!-- Include your JavaScript files here to integrate Firebase functionality -->
	
	<script>
		
function openCreateThreadPopup() {
	//slideIn(xxx)
  document.querySelector('.create-thread-popup').style.display = 'block';
}

function closeCreateThreadPopup() {
  document.querySelector('.create-thread-popup').style.display = 'none';
}	
		
		
		
  // Switch between views
    function switchView(viewId) {
      // Hide all views
      const views = document.querySelectorAll('.view');
      views.forEach(view => {
        view.classList.remove('active');
      });

      // Show the selected view
      const selectedView = document.getElementById(viewId);
      selectedView.classList.add('active');
    }	
		
		
function openReplyPopup() {
  document.querySelector('#reply-popup').style.display = 'block';
}

function closeReplyPopup() {
  document.querySelector('#reply-popup').style.display = 'none';
}

// Add event listener for reply form submission
const replyForm = document.getElementById('reply-form');
replyForm.addEventListener('submit', (event) => {
  event.preventDefault(); // Prevent the default form submission

  // Get the value from the reply input field
  const replyContent = document.getElementById('reply-content').value;

  // Perform necessary actions (e.g., save to Firebase, update UI, etc.)
  addReply(replyContent);

  // Reset the form
  replyForm.reset();

  // Close the reply pop-up
  closeReplyPopup();
});
		
		
		
		// Initialize Firebase
//firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();


		// Retrieve the thread ID from the URL query parameter (replace 'threadId' with the actual parameter name)

		// Call the function to retrieve and display the thread details on page load
const urlParams = new URLSearchParams(window.location.search);
const threadId = urlParams.get('threadId');

if (threadId) {
  getThreadDetails(threadId);
} else {
  // Handle the case when threadId is not provided
  console.error('Thread ID not found in URL parameters');
}

		


// Reference to the thread content and reply list elements
const threadContent = document.getElementById('thread-content');
const replyList = document.getElementById('reply-list');

// Function to retrieve the selected thread's details from Firebase
function getThreadDetails(threadId) {
	console.log('threadId:id  ', threadId);
  // Retrieve the thread document from Firebase using the thread ID
  firebase
    .firestore()
    .collection('threads')
    .doc(threadId)
    .get()
    .then((doc) => {
      if (doc.exists) {
        const threadData = doc.data();

        // Display the thread content
        threadContent.innerHTML = `
          <h3>${threadData.title}</h3>
          <p>Author: ${threadData.author}</p>
          <p>Timestamp: ${threadData.timestamp}</p>
          <p>${threadData.content}</p>
	  <button id="reply-button" class="button" onclick="openReplyPopup()">Reply</button>
        `;
      } else {
        // Handle the case when the document does not exist
        console.log('Thread does not exist.');
      }
    })
    .catch((error) => {
      // Handle any errors that occurred during retrieval
      console.error('Error retrieving thread details:', error);
    });
}


// Function to retrieve and display the replies for the selected thread
function getReplies() {
  // Retrieve the replies from Firestore using the thread ID
  db.collection('replies').where('threadId', '==', threadId).get()
    .then((querySnapshot) => {
      replyList.innerHTML = ''; // Clear existing replies

      querySnapshot.forEach((doc) => {
        const replyData = doc.data();

        // Create a list item for each reply
        const listItem = document.createElement('li');
        listItem.innerHTML = `
          <p>Author: ${replyData.author}</p>
          <p>Timestamp: ${replyData.timestamp}</p>
          <p>${replyData.content}</p>

        `;

        replyList.appendChild(listItem);
      });
    })
    .catch((error) => {
      console.log("Error getting replies:", error);
    });
}


// Function to add a new reply to the thread
function addReply(content) {
  // Get the current user's information (replace with your authentication system)
  const currentUser = {
    name: 'John Doe', // Example name
    // Other user information
  };

  // Create a new reply object
  const newReply = {
    author: currentUser.name,
    content: content,
    timestamp: new Date().toISOString(),
    threadId: threadId,
  };

  // Add the new reply to the 'replies' collection in Firestore
  db.collection('replies').add(newReply)
    .then((docRef) => {
      console.log("New reply added with ID: ", docRef.id);
    })
    .catch((error) => {
      console.error("Error adding reply: ", error);
    });
}


// Call the functions to retrieve and display the thread details and replies on page load
getThreadDetails();
getReplies();
		
		
		
		
		
		
		
		
// Reference to the thread list element
const threadList = document.getElementById('thread-list');

// Function to retrieve thread data from Firebase and populate the thread list
function populateThreadList() {
  const threadList = document.getElementById('thread-list');
  
  // Retrieve thread data from Firestore (replace 'threads' with your Firestore collection reference)
  firebase.firestore().collection('threads').onSnapshot((querySnapshot) => {
    threadList.innerHTML = ''; // Clear existing thread list

    querySnapshot.forEach((doc) => {
      const threadData = doc.data();

      // Create a list item for each thread
      const listItem = document.createElement('li');

      // Set the thread title, author, timestamp, etc.
      listItem.innerHTML = `
        <h3>${threadData.title}</h3>
        <p>Author: ${threadData.author}</p>
        <p>Timestamp: ${threadData.timestamp}</p>
        <!-- Additional thread information can be added here -->

<div class="viewDetails" onclick=" switchView('thread-details-view');  getThreadDetails('${doc.id}');">View Details</div>
 `;

      threadList.appendChild(listItem);
    });
  });
}


// Call the function to populate the thread list on page load
populateThreadList();
		
		
		
		
		
		
		
		
		
		
		
		// Get a reference to the form element
const createThreadForm = document.getElementById('create-thread-form');

// Add event listener for form submission
createThreadForm.addEventListener('submit', (event) => {
  event.preventDefault(); // Prevent the default form submission

  // Get the values from the form fields
  const threadTitle = document.getElementById('thread-title').value;
  const threadContent = document.getElementById('thread-content').value;

  // Perform necessary actions (e.g., save to Firebase, update UI, etc.)
  createThread(threadTitle, threadContent);
  
  // Reset the form
//  createThreadForm.reset();
});

function createThread(title, content) {
  // Get a reference to the Firestore collection
  const threadsCollection = firebase.firestore().collection('threads');

  // Create a new thread document
  threadsCollection.add({
    title: title,
    content: content,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
    // Add additional properties as needed
  })
  .then((docRef) => {
    // Thread created successfully
    console.log('Thread created with ID:', docRef.id);
    // You can update the UI or perform additional actions here
  })
  .catch((error) => {
    // Error occurred while creating thread
    console.error('Error creating thread:', error);
  });
}




		
		
		
		
		
		
		
		
	</script>
</body>
  <!-- Footer -->

</html>

